---
title: "Midterm 1 Keys"
author: "Iliya Voytsyshyn"
date: "2024-02-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load library:

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(skimr)
```

>>>
# Lab 2: 

```{r}
object <- matrix(dataset.data, nrow=n)
```


```{r}
object <- cbind(dataset, row_name = object_with_mean) #allows me to addd coloumn
```

>>>
# Lab 3: 

```{r}
object <- data.frame(matrix_1, matrix_2, matrix_2)
```

```{r}
write.csv(dataset, "name_of_it", row.names = FALSE)
object <- read_csv("folder/dataset_name")
library(janitor)
clean_names(dataset)
object <- readr::read_csv("folder/dataset_name")
```


For basic analysis:
```{r}
str(dataset) 
glimpse(dataset)
names(dataset)
summary(dataset)
dim(dataset)
```

```{r}
head(dataset, n) #gives you first row frame
tail(dataset, n) #last rows 

table(dataset$column)
count(dataset$column) #for the pipe
```



Mean alternative:
```{r}
object <- t.test(large$sleep_total, small$sleep_total)
object 
```

Mean compersion: 
```{r}
if (mean(filtered_dataset$column) > mean(filtered_dataset.1$column)) {
  cat("The mean of 'filtered_dataset' is bigger.\n")
} else if (mean(filtered_dataset1$column) > mean(filtered_dataset$column)) {
  cat("The mean of 'filtered_dataset1' is bigger.\n")
} else {
  cat("The means are equal.\n")
}
```



Finding max of ceratin colums:
```{r}
object <- max(dataset$column)
object_2 <- dataset[dataset$column == object, c("coulumn", "column", "column")]
object_2
```

>>>
 Lab 4:

```{r}
select(dataset, matches/contains/ends_with("a.+er")) #handy bit of code for the project (parts of words)

select(dataset, column)

select_if(dataset, ~!is.numeric(.)) # (.) all of the cells, ! - all other then mentions data 

filter(dataset, column %in% c(167, 175))
```



```{r}
largest_home_range <- vertebrate_clean %>%
  filter(class == "aves" & !is.na(mean_hra_m2)) %>% #for data where we have NA
  arrange(desc(mean_hra_m2)) %>%
  head(1) %>%
  select(mean_hra_m2, common_name, genus, species)
largest_home_range
```


>>>
# Lab 5

```{r}
filter(dataset, column == "AL" & column1 > 350) 
```


Here we compere means
```{r}
if (mean(mammals$mass[mammals$genus == "Lophocebus"]) > 
    mean(mammals$mass[mammals$genus == "Erythrocebus"]) &&
    mean(mammals$mass[mammals$genus == "Erythrocebus"]) > 
    mean(mammals$mass[mammals$genus == "Macaca"])) {
  cat("Lophocebus has the smallest newborn mass among the specified genera.\n")
} else if (mean(mammals$mass[mammals$genus == "Erythrocebus"]) > 
           mean(mammals$mass[mammals$genus == "Lophocebus"]) &&
           mean(mammals$mass[mammals$genus == "Lophocebus"]) > 
           mean(mammals$mass[mammals$genus == "Macaca"])) {
  cat("Erythrocebus has the smallest newborn mass among the specified genera.\n")
} else if (mean(mammals$mass[mammals$genus == "Macaca"]) > 
           mean(mammals$mass[mammals$genus == "Lophocebus"]) &&
           mean(mammals$mass[mammals$genus == "Lophocebus"]) > 
           mean(mammals$mass[mammals$genus == "Erythrocebus"])) {
  cat("Macaca has the smallest newborn mass among the specified genera.\n")
} else {
  cat("The means are equal.\n")
}
```




```{r}
fish %>% 
  select(lakeid, radii_length_mm) %>% 
  filter(lakeid == "AL" | lakeid == "AR") %>% 
  filter (between(radii_length_mm, 2, 4)) %>% 
  arrange(desc(radii_length_mm)) #here we combine AR and AL and sort them from high to low
```

```{r}
fish %>% 
  mutate(length_mm = length*10) %>% 
  select(fish_id, length, length_mm) # allows to create new column fro existing one
```
  
```{r}
mammals %>%
  mutate_all(tolower) # all to lower case

```


>>>
# Lab 6 

Pullinng out top value: 
```{r}
mammals %>% 
  select(genus, species, max_life) %>%
  mutate(max_life_new = ifelse(max_life == -999.00, NA, max_life))%>% 
  arrange(desc(max_life)) %>%
  slice(1)
```



Find your hero in the superhero_info data? Show their info!  
```{r}
my_favorite <- superhero_power %>%
  filter(hero_names == "Groot") %>%
  select_if(~all(. == "TRUE") | . == "Groot")
my_favorite
```

```{r}
my_hero_info <- superhero_power %>%
  filter(hero_names %in% my_favorite$hero_names)
my_hero_info
```



Basic data analysis 
```{r}
tabyl(dataset, column)
```

>>>
# Lab 7

```{r}
msleep24$sleep_total_24 <- as.numeric(msleep24$sleep_total_24)
hist(msleep24$sleep_total_24, main = "Histogram of sleept_total", xlab = "sleept_total") 
```




```{r}
msleep %>%
  filter(bodywt > 200) %>%
  summarise(mean_sleep_lg = mean(sleep_total),
            min_sleep_lg = min(sleep_total),
            max_sleep_lg = max(sleep_total), 
            sd_sleep_lg = sd(sleep_total), 
            total=n())
```
            
```{r}
msleep %>% 
  filter(bodywt > 100) %>%
  n_distinct()
```

```{r}
msleep %>%
  group_by(order) %>%
  summarize(min_brainwt = min(brainwt, na.rm=TRUE),
            max_brainwt = max(brainwt, na.rm=TRUE),
            mean_brainwt = mean(brainwt, na.rm=TRUE),
            total=n())
```


            
```{r}
penguins %>%
  group_by(species, island) %>%
  filter(!is.na(body_mass_g)) %>%
 summarize(mean_body_mass_g = mean(body_mass_g))
```

```{r}
penguins %>% 
  group_by(species, island) %>% 
  summarize(n=n(), .groups= 'keep')#the .groups argument here just prevents a warning message, n=n is a number of observations
```

  
  
```{r}
penguins %>% 
  count(island, species, sort = T) # sort=T will arrange in descending order
```

```{r}
penguins %>%
  group_by(species, island) %>%
  summarize(n_nas = sum(is.na(sex)))
```
  
```{r}
penguins %>%
  summarize(across(contains("mm"), \(x) mean(x, na.rm = TRUE))) #to get rid of R console, (\(x))
```
  
```{r}
penguins %>%
  summarise(across(starts_with("bill"), mean, na.rm=T))
```


  
MIDTERM 2 

>>>
LAB 8 

1/ 

```{r}
penguins %>% 
  count(island, species)
```

```{r}
penguins %>% 
  group_by(island, species) %>% 
  summarize(n_penguins=n(), .groups = 'keep',
            mean_fliper=mean(flipper_length_mm, na.rm = T),
            mean_body=mean(body_mass_g, na.rm = T),
            mean_bill_d=mean(bill_depth_mm, na.rm = T),
            mean_bill_l=mean(bill_length_mm, na.rm = T))
```


```{r}
penguins %>%
  summarise(across(!c(species, island, sex, year), mean, na.rm = TRUE)) %>%
  summarise(across(contains("mm"), mean, na.rm = TRUE)) #important
```

2/


```{r}
life_history <- life_history %>%
  mutate(across(everything(), ~ ifelse(.x %in% c(-999.00, ".", " ", "not measured"), NA, .x))) #important
```

```{r message=FALSE, warning=FALSE}
homerange <- read_csv("data/Tamburelloetal_HomeRangeDatabase.csv", na = c("", "NA", "\\"))
```

```{r}
penguins %>%
  summarise(across(!c(species, island, sex, year), mean, na.rm = TRUE)) %>%
  summarise(across(contains("mm"), mean, na.rm = TRUE)) #important
```


>>>
LAB 9 

1/

```{r}
billboard2 <- billboard %>% 
  pivot_longer(wk1:wk76, # a range of columns
               names_to = "week",
               values_to = "rank", 
               values_drop_na = TRUE #this will drop the NA's
               )
billboard2
```

```{r}
billboard3 <- billboard %>% 
  pivot_longer(-c(artist, track, date.entered), #specific columns to stay fixed
               names_to = "week",
               values_to = "rank",
               values_drop_na = TRUE
               )
billboard3
```

```{r}
plant_2 <- plant %>% 
  pivot_longer(-c(genotype, water_sched_prog, greenhouse), #specific columns to stay fixed
               names_to = "day",
               values_to = "amaunt",
               values_drop_na = TRUE
               )
plant_2
```

2/

```{r}
heartrate3 <- heartrate2 %>% 
  separate(patient, into=c("patient", "sex"), sep="_") %>% 
  pivot_longer(-c(patient, sex),
               names_to = "drug",
               values_to = "heartrate")
heartrate3
```


```{r}
heartrate3 %>% 
  unite(patient_sex, "patient", "sex", sep=" ")
```

```{r}
beachbugs_wide %>% 
  pivot_longer(-year,
               names_to = "site",
               values_to = "buglevels", 
               values_drop_na = TRUE)
```

>>>
LAB 10 

1/

```{r}
homerange %>% 
  ggplot(aes(x=trophic.guild)) + 
  geom_bar() #good for counts
```

```{r}
homerange %>%
  filter(class == "mammalia") %>%
  select(common.name, log10.mass) %>%
  top_n(-10, log10.mass) %>% # how to select top of something
  #arrange(log10.mass) %>%
  #head(10) %>%
  ggplot(aes(x = log10.mass, y = common.name)) +
  geom_col()#+
  #coord_flip()
```


2/

```{r}
penguins %>% 
  ggplot(aes(x=species))+
  geom_bar() #plotting the raw data
```


```{r}
penguins %>%
  filter(sex!="NA") %>%
  group_by(sex) %>%
  summarise(ave_bill_length_mean = mean(bill_length_mm)) %>%
  ggplot(aes(x=sex, y=ave_bill_length_mean))+
  geom_col()
```


```{r}
homerange %>%
  group_by(trophic.guild) %>%
  summarise(log10.mass_mean = mean(log10.mass, na.rm = TRUE))
```

```{r}
homerange %>% 
  filter(trophic.guild == "carnivore" & class == "mammalia") %>%
  ggplot(aes(x = family, y = log10.hra)) +
  geom_boxplot()
```

>>>
LAB 11

1/
```{r}
options(scipen=999)#cancels scientific notation for the session
```

`geom_col`
```{r}
life_history %>% 
  count(order, count = T) %>% #like arrange
  ggplot(aes(x=order, y=n))+
  geom_col()+
  coord_flip()
```
```{r}
life_history %>%
  group_by(order) %>%
  summarise(mean_mass = mean(mass, na.rm=T)) %>%
  ggplot(aes(x=reorder(order, mean_mass), y=mean_mass))+
  geom_col()+
  coord_flip()+
  scale_y_log10() # usefull for scaling and ordering
```


`geom_bar`
```{r}
life_history %>% 
  ggplot(aes(x=order))+
  geom_bar()+
  coord_flip()
```


`geom_jitter`
```{r}
life_history %>%
  ggplot(aes(x=gestation, y=wean_mass))+
  geom_jitter(na.rm = T)+ #prevemts overploting, #for two continues variables 
   scale_y_log10()
```


`geom_boxplot`
```{r}
life_history %>%
  ggplot(aes(x=order, y=mass))+
  geom_boxplot(na.rm=T)+
  scale_y_log10()+
  coord_flip()
```


`geom_point`
```{r}
elephants %>%
  ggplot(aes(x=age, y=height))+
  geom_point()+#for two continues variables 
  geom_smooth(method = lm, se=T)
```
```{r}
elephants %>% 
  ggplot(aes(x=age, y=height)) + 
  geom_point() + 
  geom_smooth(method=lm, se=T)+ #adds the Standard Error 
  labs(title="Elephant Age vs. Height", #adds the tittle
       x="Age (years)",
       y="Height (cm)")+
  theme(plot.title = element_text(size = rel(1.75), hjust = 0.5))
```
```{r}
life_history %>% 
  ggplot(aes(x=gestation, y=log10(mass), size=mass))+
  geom_point(na.rm=T)
```



2/


`fill=trophic.guild`
```{r}
homerange %>% 
  ggplot(aes(x=taxon, fill= trophic.guild))+
  geom_bar()+
  coord_flip()+
  labs(tittle= "Observations by Taxon", 
       x="Taxonomic Group")
```

`position="dodge"`
```{r}
homerange %>% 
  ggplot(aes(x=taxon, fill= trophic.guild))+
  geom_bar(position="dodge")+ #Basicly it seperates the fill categories in different bars
  coord_flip()+
  labs(tittle= "Observations by Taxon", 
       x="Taxonomic Group")
```


`color=thermoregulation`
```{r}
p <- homerange %>% 
  ggplot(aes(x= log10.mass, y= log10.hra))
```
```{r}
p + geom_point(aes(color=thermoregulation, shape=thermoregulation), size = 1.5) #shortcut
```


>>>
LAB 12

1/

```{r}
deserts %>%
  filter(species_id %in% c("DS", "DM")) %>%
  mutate(year==as.factor(year)) %>% # helps to solve the factor problem 
  group_by(year, species_id) %>%
  summarise(n=n(), .groups='keep')%>%
  pivot_wider(names_from = species_id, values_from = n)
```


`geom_line`
```{r}
deserts %>%
  filter(species_id == "DM" | species_id == "DS") %>%
  mutate(year = as.factor(year)) %>%
  group_by(year, species_id) %>%
  summarise(n = n(), .groups = 'keep') %>%
  ggplot(aes(x = year, y = n, group = species_id, color = species_id)) +
  geom_line() +
  geom_point(shape = 2) + 
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(title = "Number of Species DM and DS", x = "Year", y = "n")
```


`geom_histogram` `bins = 20`
```{r}
homerange %>% 
  ggplot(aes(x = log10.mass)) +
  geom_histogram(bins = 20)+ #we can adjust the number of bins with the bins argument
  labs(title = "Distribution of Body Mass")
```

`alpha, color, fill`
```{r}
homerange %>% 
  ggplot(aes(x=log10.hra)) +
  geom_histogram(aes(y = after_stat(density)), fill = "deepskyblue4", alpha = 0.4, color = "black")+
  geom_density(color = "red")+
  labs(title = "Distribution of hra")
```

```{r}
homerange %>%
  mutate(mass_category= case_when(log10.mass<=1.75 ~ "small",
                                  log10.mass>1.75 & log10.mass<=2.75 ~ "medium", 
                                  log10.mass>2.75 ~ "large")) %>% #how to sort values
  ggplot(aes(x=mass_category, fill=trophic.guild))+
  geom_bar(position = "dodge") #side by side
```

`quantcut`
```{r}
quartiles <-quantcut(homerange$log10.hra)
table(quartiles)
```
```{r}
homerange %>%
  mutate(hra_category= case_when(log10.hra<3.65 ~ "1st quartile",
                                  log10.hra>3.65 & log10.hra<=4.59 ~ "2st quartile",
                                  log10.hra>4.59 & log10.hra<=6.03 ~ "3st quartile", 
                                  log10.hra>6.03 ~ "4st quartile")) %>% #how to get quartiles 
  filter(hra_category == "2st quartile") %>% #plotting specific quartiles
  ggplot(aes(x=class, y=log10.mass, fill=class))+
  geom_boxplot()
```


2/

`facet_grid()`
```{r}
homerange %>% 
  ggplot(aes(x=taxon, y=log10.mass))+
  geom_boxplot()+
  facet_grid(trophic.guild~. )+ #you get result in rows
  theme(axis.text.x = element_text(angle = 60, hjust=1))
```
```{r}
homerange %>% 
  ggplot(aes(x=taxon, y=log10.mass))+
  geom_boxplot()+
  facet_grid(trophic.guild~thermoregulation)+ #more then one categorical variables rows~columns.
  theme(axis.text.x = element_text(angle = 60, hjust=1))
```


`theme_economist` `x=NULL   `
```{r}
q <- homerange %>% 
  ggplot(aes(x=log10.mass, y=log10.preymass, color=taxon))+
  geom_point(na.rm=T)
```
```{r}
p + 
  theme_economist()+
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 60, hjust=0))+
  labs(title = "Observations by Taxon in Homerange Data",
       x = NULL, #remove the lable from the x axis 
       y= "n",
       fill= "Trophic Guild")
```


>>>
practice midterm 

```{r}
surgery_new <- surgery %>%
  group_by(month) %>%
  mutate(mort30_n = ifelse(mort30 == "Yes", 1, 0),
         complication_n = ifelse(complication =="Yes", 1, 0)) %>% 
  summarise(n_deaths=sum(mort30_n),
            n_comp=sum(complication_n)) %>%
  arrange(desc(n_deaths))
surgery_new
```
```{r}
surgery_new %>%
  ggplot(aes(x=month, y=n_deaths, fill=n_comp))+
  geom_col(alpha=0.8, color="black")+
  
  labs(title="30-Day Mortality by Month",
       x=NULL,
       y="Rate")+
  scale_x_discrete(limits=c("Jan","Feb","Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))+
  theme_light()
```




